# 割り勘・請求管理アプリ「Walico（ワリコ）」要件定義書

## 1. プロジェクト概要

* **アプリ名:** Walico（ワリコ）
* **目的:** 恋人とのデートや食事における「立て替え払いの請求忘れ」を防ぐ。
* **コンセプト:** 「3秒で完結」。財布をしまう流れで入力から請求までを完了させ、ユーザーの記憶や手間への依存をゼロにする。
* **コアバリュー:**
* **Speed:** ネイティブアプリのように即起動・即入力（PWA）。
* **Privacy:** レシート画像は一時保管のみで自動消去。
* **Hybrid:** 普段は爆速割り勘、必要な時だけ詳細割り勘。



## 2. 技術スタック

* **Frontend:** Next.js (App Router) / TypeScript
* **Styling:** Tailwind CSS
* **PWA Framework:** `next-pwa`
* **Database:** Turso (libSQL)
* **Object Storage:** **Cloudflare R2** (レシート画像の一時保存)
* **AI (OCR/Vision):** Gemini 2.0 Flash
* * **Infrastructure:** Vercel (Frontend/API), Cloudflare R2(Storage)

## 3. 機能要件

### 3.1 PWA (Progressive Web App) 機能

* **ホーム画面追加:** スマートフォンのホーム画面にアイコンとして追加可能にする（Web Manifest）。
* **フルスクリーン表示:** ブラウザのアドレスバーを排除し、ネイティブアプリ同様の没入感を提供する。

### 3.2 レシート解析・入力フロー

1. **撮影 & アップロード:**
* アプリ内カメラまたは画像選択によりレシートを取得。
* 画像を **Cloudflare R2** へ即時アップロード。


2. **AI解析:**
* 画像をAIモデルへ渡し、解析を実行。
* **抽出データ:** 店舗名、日時、合計金額、明細リスト。



### 3.3 計算ロジック（ハイブリッドUI）

**初期表示（レベル1：簡易モード）**

* **スライダー操作:** 「自分 : 相手」の比率調整（デフォルト 50:50）。
* **端数処理:** ワンタップで端数切り上げ・切り捨て調整。

**詳細展開（レベル2：明細モード）**

* **アコーディオンUI:** 明細リストを展開表示。
* **個別仕分け:** 各品目を「自分」「割り勘」「相手」に振り分け、合計額を再計算。

### 3.4 共有・通知機能

* **LINE連携:** 確定した請求額と内容をテキスト生成し送信。
* **履歴保存:** 確定情報をTurso (DB) へ保存。

### 3.5 画像データ管理 (ライフサイクル)

* **一時保存:** レシート画像は確認用としてR2に保存する。
* **自動削除:**
* **トリガー:** 精算処理（データ保存）完了後。
* **目的:** プライバシー保護およびストレージコストの削減。



## 4. データモデル設計案 (Turso/SQLite)

### Transactions Table (支払い記録)

| Column | Type | Note |
| --- | --- | --- |
| `id` | TEXT | UUID (PK) |
| `store_name` | TEXT | 店名 |
| `visit_date` | TEXT | 利用日 |
| `total_amount` | INTEGER | 合計金額 |
| `amount_partner` | INTEGER | 相手への請求額 |
| `receipt_image_url` | TEXT | R2のURL (※12時間後に無効化) |
| `created_at` | INTEGER | 作成日時 |

※ `receipt_image_url` は一時的な参照用とし、永続化しない運用とする。

## 5. 画面構成 (UI/UX)

**シングルページ完結型 (Mobile PWA Layout)**

1. **Header:**
* アプリロゴ (Walico)
* カメラ起動ボタン


2. **Status Bar:** AI解析中ローディング表示 / オフライン検知表示
3. **Result & Edit Area:**
* 解析結果表示
* ハイブリッド計算UI（スライダー / 明細リスト）


4. **Floating Action Button (Fixed Footer):**
* `[LINEで送る]` (精算確定ボタンを兼ねる)



## 6. 非機能要件

* **Installability:** ユーザーにホーム画面への追加を促すUI/UX設計。